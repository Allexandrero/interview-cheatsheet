## Два слова о том, что это вообще такое

Модель сущность-связь (ER-модель) (англ. entity-relationship model, ERM) — модель данных, позволяющая описывать концептуальные схемы предметной области.

ER-модель используется при высокоуровневом (концептуальном) проектировании баз данных. С её помощью можно выделить ключевые сущности и обозначить связи, которые могут устанавливаться между этими сущностями.

Вообще, она может использоваться и в других ситуациях, просто так сложилось, что именно в проектировании БД это максимально часто применимая вещь.

Во время проектирования баз данных происходит преобразование ER-модели в конкретную схему базы данных на основе выбранной модели данных (реляционной, объектной, сетевой или др.).

ER-модель представляет собой формальную конструкцию, которая сама по себе не предписывает никаких графических средств её визуализации. В качестве стандартной графической нотации, с помощью которой можно визуализировать ER-модель, была предложена диаграмма сущность-связь (ER-диаграмма) (англ. entity-relationship diagram, ERD).

## Теперь к делу

При разработке ER-моделей необходимо получить следующую информацию о предметной области [60]:

* Список сущностей предметной области;
* Список атрибутов сущностей;
* Описание взаимосвязей между сущностями;

ER-диаграммы удобны тем, что процесс выделения сущностей, атрибутов и связей итерационный. Разработав первый приближенный вариант диаграмм, мы уточняем их, опрашивая экспертов предметной области. При этом документацией, в которой фиксируются результаты бесед, служат сами ER-диаграммы.

Предположим, что поставлена задача разработать информационную систему по заказу некоторой оптовой торговой фирмы. В первую очередь необходимо изучить предметную область и процессы, происходящие в ней. Для этого мы опрашиваем сотрудников фирмы, читаем документацию, изучаем формы заказов, накладных и т.п.

Например, в ходе беседы с менеджером по продажам выяснилось представление менеджера о том, что проектируемая система должна выполнять следующие действия:

- Хранить информацию о покупателях.
- Печатать накладные на отпущенные товары.
- Следить за наличием товаров на складе.
  
Выделим все существительные в этих предложениях — это будут потенциальные кандидаты на сущности и атрибуты, и проанализируем их (непонятные термины будем выделять знаком вопроса):

* Покупатель — явный кандидат на сущность.
* Накладная — явный кандидат на сущность.
* Товар — явный кандидат на сущность
* (?)Склад — а вообще, сколько складов имеет фирма? Если несколько, то это будет кандидатом на новую сущность.
* (?)Наличие товара — это, скорее всего, атрибут, но атрибут какой сущности?
  
Начальный вариант ERD
![ERD](https://studref.com/htm/img/15/6041/77.png)

Сразу возникает очевидная связь между сущностями — «покупатели могут покупать много товаров» и «товары могут продаваться многим покупателям». 

Задав менеджеру дополнительные вопросы, выяснили, что фирма имеет несколько складов. Причем, каждый товар может храниться на нескольких складах и быть проданным с любого склада.

Куда поместить сущности «Накладная» и «Склад» и с чем их связать? Спросим себя, как связаны эти сущности между собой и с сущностями «Покупатель» и «Товар»? Покупатели покупают товары, получая при этом накладные, в которые внесены данные о количестве и цене купленного товара. Каждый покупатель может получить несколько накладных. Каждую накладную выписывают на одного покупателя.

Каждая накладная должно содержать несколько товаров (не бывает пустых накладных). Каждый товар, в свою очередь, может быть продан нескольким покупателям по нескольким накладным. Кроме того, каждая накладная должна быть выписана с определенного склада, и с любого склада может быть выписано много накладных. Таким образом, после уточнения, диаграмма будет выглядеть как на картинке.

Пора подумать об атрибутах сущностей. Беседуя с сотрудниками фирмы, мы выяснили следующее.

* Каждый покупатель является юридическим лицом и имеет наименование, адрес, банковские реквизиты.
* Каждый товар имеет наименование, цену, а также характеризуется единицами измерения.
* Каждая накладная имеет уникальный номер, дату выписки, список товаров с количествами и ценами, а также общую сумму накладной. Накладная выписывается с определенного склада и на определенного покупателя.
* Каждый склад имеет свое наименование.
  
Нормализованный вариант ERD
![ERD](https://studref.com/htm/img/15/6041/78.png)

Снова выпишем все существительные, которые будут потенциальными атрибутами, и проанализируем их.

* Юридическое лицо — термин риторический, мы не работаем с физическими лицами. Не обращаем внимания.
* Наименование покупателя — явная характеристика покупателя.
* Адрес — явная характеристика покупателя.
* Банковские реквизиты — явная характеристика покупателя.
* Наименование товара — явная характеристика товара.
* (?)Цена товара — похоже, что это характеристика товара. Отличается ли эта характеристика от цены в накладной?
* Единица измерения — явная характеристика товара.
* Номер накладной — явная уникальная характеристика накладной.
* Дата накладной — явная характеристика накладной.
* (?)Список товаров в накладной — список не может быть атрибутом. Вероятно, нужно выделить этот список в отдельную сущность.
* (?)Количество товара в накладной — это явная характеристика, но характеристика чего? Это характеристика не просто «товара», а «товара в накладной».
* (?)Цена товара в накладной — опять же это должна быть не просто характеристика товара, а характеристика товара в накладной. Но цена товара уже встречалась ранее — это одно и то же?
* Сумма накладной — явная характеристика накладной. Эта характеристика не является независимой. Сумма накладной равна сумме стоимостей всех товаров, входящих в накладную.
* Наименование склада — явная характеристика склада.
В ходе дополнительной беседы с менеджером удалось прояснить различные понятия цен. Оказалось, что каждый товар имеет некоторую текущую цену. Это цена, по которой товар продается в данный момент. Естественно, что эта цена может меняться со временем. Цена одного и того же товара в разных накладных, выписанных в разное время, может быть различной. Таким образом, есть две цены — цена товара в накладной и текущая цена товара.

С возникающим понятием «Список товаров в накладной» все довольно ясно. Сущности «Накладная» и «Товар» связаны друг с другом отношением типа «много-ко-многим». Такая связь, как уже отмечалось ранее, должна быть расщеплена на две связи типа «один-ко-многим». Для этого требуется дополнительная сущность. Этой сущностью и будет сущность «Список товаров в накладной». Связь ее с сущностями «Накладная» и «Товар» характеризуется следующими фразами:

* «каждая накладная обязана иметь несколько записей из списка товаров в накладной»;
* «каждая запись из списка товаров в накладной обязана включаться ровно в одну накладную»;
* «каждый товар может включаться в несколько записей из списка товаров в накладной»;
* «каждая запись из списка товаров в накладной обязана быть связана ровно с одним товаром».
  
ERD, детализированная до атрибутов сущностей
![ERD](https://studref.com/htm/img/15/6041/79.png)

Атрибуты «Количество товара в накладной» и «Цена товара в накладной» являются атрибутами сущности «Список товаров в накладной».

Точно так же поступим со связью, соединяющей сущности «Склад» и «Товар». Введем дополнительную сущность «Товар на складе». Атрибутом этой сущности будет «Количество товара на складе». Таким образом, товар будет числиться на любом складе и количество его на каждом складе будет свое. Теперь можно внести все это в диаграмму.
  

Подробнее:  
https://dic.academic.ru/dic.nsf/ruwiki/147094  
https://studref.com/351182/informatika/primer_razrabotki_prostoy_modeli  
https://habr.com/ru/post/50312/  
https://www.youtube.com/watch?v=VJp8f4gZgtM
